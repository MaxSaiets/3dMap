# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –ª–æ–≥—ñ–∫–∏ –æ–±—Ä–æ–±–∫–∏ –±—É–¥—ñ–≤–µ–ª—å

## ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –ó–ê–í–ï–†–®–ï–ù–Ü

### 1. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–¥–≤—ñ–π–Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –±—É–¥—ñ–≤–µ–ª—å –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞–ª–∏—Å—è –¥–≤—ñ—á—ñ - –æ–¥–∏–Ω —Ä–∞–∑ –≤ `main.py` –¥–ª—è `flatten_heightfield_under_buildings`, –¥—Ä—É–≥–∏–π —Ä–∞–∑ –≤ `building_processor.py` –¥–ª—è `process_buildings`.

**–†—ñ—à–µ–Ω–Ω—è:**
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—Ç—å—Å—è **–û–î–ò–ù –†–ê–ó** –Ω–∞ –ø–æ—á–∞—Ç–∫—É –≤ `main.py` (—Ä—è–¥–æ–∫ 556-600)
- –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è `gdf_buildings_local` –∑ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–∏–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
- –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è `building_geometries_for_flatten` –¥–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è —Ä–µ–ª—å—î—Ñ—É
- –í `process_buildings` –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –≤–∂–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–∏–π `gdf_buildings_local` –∑ –ø—Ä–∞–ø–æ—Ä—Ü–µ–º `coordinates_already_local=True`

**–§–∞–π–ª–∏:**
- `main.py`: —Ä—è–¥–∫–∏ 556-600, 694
- `services/building_processor.py`: —Ä—è–¥–∫–∏ 25-26, 43-68

---

### 2. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –º—ñ–∂ flatten —Ç–∞ process_buildings

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤ `flatten_heightfield_under_buildings` —Ç–∞ `process_buildings` –º–æ–≥–ª–∏ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—Ç–∏.

**–†—ñ—à–µ–Ω–Ω—è:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –æ–¥–Ω–∞ —ñ —Ç–∞ –∂ —Ñ—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –û–±–∏–¥–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `building_geometries_for_flatten` (–≤–∂–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏)
- –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ, —â–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å

**–§–∞–π–ª–∏:**
- `main.py`: —Ä—è–¥–∫–∏ 594-598

---

### 3. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É –∑ safety_margin —Ç–∞ embed_depth

**–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫—â–æ `embed_depth > safety_margin`, –±—É–¥—ñ–≤–ª—è –º–æ–≥–ª–∞ –æ–ø–∏–Ω–∏—Ç–∏—Å—è –ø—ñ–¥ –∑–µ–º–ª–µ—é.

**–†—ñ—à–µ–Ω–Ω—è:**
```python
# –°—Ç–∞—Ä–∞ –ª–æ–≥—ñ–∫–∞ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê):
ground_min_safe = ground_min + 0.1
base_z = ground_min_safe - embed_depth  # –ú–æ–∂–µ –±—É—Ç–∏ < ground_min!

# –ù–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ (–ü–†–ê–í–ò–õ–¨–ù–ê):
if embed_depth > 0:
    base_z = max(ground_min - embed_depth, ground_min - safety_margin)
else:
    base_z = ground_min + safety_margin

# –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞:
min_allowed_z = ground_min - foundation_depth_eff + safety_margin
if translate_z < min_allowed_z:
    translate_z = min_allowed_z
```

**–§–∞–π–ª–∏:**
- `services/building_processor.py`: —Ä—è–¥–∫–∏ 240-262

---

### 4. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏—Å–æ—Ç–∏ —Ä–µ–ª—å—î—Ñ—É –ø—ñ–¥ –±—É–¥—ñ–≤–ª–µ—é

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Å–µ–º–ø–ª—ñ–Ω–≥ (–∫–æ–Ω—Ç—É—Ä, –∫—É—Ç–∏, —Ü–µ–Ω—Ç—Ä–æ—ó–¥) –º—ñ–≥ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –≤–∞–∂–ª–∏–≤—ñ —Ç–æ—á–∫–∏ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –±—É–¥—ñ–≤–µ–ª—å.

**–†—ñ—à–µ–Ω–Ω—è:**
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Å–µ–º–ø–ª—ñ–Ω–≥** –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–ª–æ—â—ñ –±—É–¥—ñ–≤–ª—ñ:
  - –ú–∞–ª—ñ (< 100 –º¬≤): –∫–æ–Ω—Ç—É—Ä + –∫—É—Ç–∏ + —Ü–µ–Ω—Ç—Ä
  - –°–µ—Ä–µ–¥–Ω—ñ (100-1000 –º¬≤): –∫–æ–Ω—Ç—É—Ä + —Ä–µ–≥—É–ª—è—Ä–Ω–∞ —Å—ñ—Ç–∫–∞ 3x3
  - –í–µ–ª–∏–∫—ñ (> 1000 –º¬≤): –∫–æ–Ω—Ç—É—Ä + —â—ñ–ª—å–Ω–∞ —Å—ñ—Ç–∫–∞ 5x5
- –ó–∞–≤–∂–¥–∏ –¥–æ–¥–∞—é—Ç—å—Å—è —Ü–µ–Ω—Ç—Ä–æ—ó–¥ —Ç–∞ –∫—É—Ç–æ–≤—ñ —Ç–æ—á–∫–∏

**–§–∞–π–ª–∏:**
- `services/building_processor.py`: —Ä—è–¥–∫–∏ 71-145

---

### 5. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ –∞–≥—Ä–µ—Å–∏–≤–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø—ñ—Å–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—ñ–∫—Å–æ–≤–∞–Ω–∏–π –ø–æ—Ä—ñ–≥ `translate_z + 0.2` –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–≤ –¥–ª—è –±—É–¥—ñ–≤–µ–ª—å —Ä—ñ–∑–Ω–æ—ó —Ñ–æ—Ä–º–∏.

**–†—ñ—à–µ–Ω–Ω—è:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **–Ω–∏–∂–Ω—ñ 20% –≤–∏—Å–æ—Ç–∏ –±—É–¥—ñ–≤–ª—ñ** –∑–∞–º—ñ—Å—Ç—å —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ–≥–æ –ø–æ—Ä–æ–≥—É
- –î–æ–¥–∞–Ω–∞ **—Ñ—ñ–Ω–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –í–°–Ü–• –≤–µ—Ä—à–∏–Ω** –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó, —â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –ø—ñ–¥ –∑–µ–º–ª–µ—é
- –ê–≥—Ä–µ—Å–∏–≤–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–Ω—ñ–º–∞—î –±—É–¥—ñ–≤–ª—é, —è–∫—â–æ –±—É–¥—å-—è–∫–∞ –≤–µ—Ä—à–∏–Ω–∞ –ø—ñ–¥ –∑–µ–º–ª–µ—é

**–§–∞–π–ª–∏:**
- `services/building_processor.py`: —Ä—è–¥–∫–∏ 290-350, 408-450

---

### 6. ‚úÖ –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø—ñ—Å–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è —Ä–µ–ª—å—î—Ñ—É

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —â–æ —Ä–µ–ª—å—î—Ñ –¥—ñ–π—Å–Ω–æ –≤–∏—Ä—ñ–≤–Ω—è–Ω–∏–π –ø—ñ—Å–ª—è `flatten_heightfield_under_buildings`.

**–†—ñ—à–µ–Ω–Ω—è:**
- –ü—ñ—Å–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –¥—ñ–∞–ø–∞–∑–æ–Ω –≤–∏—Å–æ—Ç –ø—ñ–¥ –ø–æ–ª—ñ–≥–æ–Ω–æ–º
- –Ø–∫—â–æ —Ä—ñ–∑–Ω–∏—Ü—è –±—ñ–ª—å—à–µ 1—Å–º - –≤–∏–≤–æ–¥–∏—Ç—å—Å—è –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
- –¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î –≤–∏—è–≤–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è–º

**–§–∞–π–ª–∏:**
- `services/terrain_generator.py`: —Ä—è–¥–∫–∏ 718-725

---

### 7. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ —Å–µ–º–ø–ª—ñ–Ω–≥ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –±—É–¥—ñ–≤–µ–ª—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Å–µ–º–ø–ª—ñ–Ω–≥ –±—É–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–º –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –±—É–¥—ñ–≤–µ–ª—å.

**–†—ñ—à–µ–Ω–Ω—è:**
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Å–µ–º–ø–ª—ñ–Ω–≥ (–¥–∏–≤. –ø—É–Ω–∫—Ç 4)
- –ë—ñ–ª—å—à–µ —Ç–æ—á–æ–∫ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –±—É–¥—ñ–≤–µ–ª—å
- –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ —Ç–æ—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó –≤–∏—Å–æ—Ç–∏ —Ä–µ–ª—å—î—Ñ—É

**–§–∞–π–ª–∏:**
- `services/building_processor.py`: —Ä—è–¥–∫–∏ 71-145

---

### 8. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–∫—É MultiPolygon

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª—è MultiPolygon –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è –æ–¥–∏–Ω `translate_z` –¥–ª—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–æ–Ω–∏ –Ω–∞ —Ä—ñ–∑–Ω—ñ–π –≤–∏—Å–æ—Ç—ñ —Ä–µ–ª—å—î—Ñ—É.

**–†—ñ—à–µ–Ω–Ω—è:**
- –ö–æ–∂–µ–Ω –ø–æ–ª—ñ–≥–æ–Ω –≤ MultiPolygon –º–∞—î **—Å–≤—ñ–π –æ–∫—Ä–µ–º–∏–π `translate_z`**
- `translate_z` —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ–ª—ñ–≥–æ–Ω—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –π–æ–≥–æ –≤–∏—Å–æ—Ç–∏ —Ä–µ–ª—å—î—Ñ—É
- –ö–æ–∂–µ–Ω –ø–æ–ª—ñ–≥–æ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å–∏–≤–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –æ–∫—Ä–µ–º–æ

**–§–∞–π–ª–∏:**
- `services/building_processor.py`: —Ä—è–¥–∫–∏ 379-450

---

### 9. ‚úÖ –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—É –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∞–ª–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º.

**–†—ñ—à–µ–Ω–Ω—è:**
- –î–æ–¥–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –î–æ–¥–∞–Ω–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤ (–≤–µ–ª–∏–∫–∏–π —É—Ö–∏–ª —Ä–µ–ª—å—î—Ñ—É)
- –î–æ–¥–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å (–∫–æ–ª–∏ –±—É–¥—ñ–≤–ª—è –ø—ñ–¥–Ω—ñ–º–∞—î—Ç—å—Å—è)
- –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø—ñ—Å–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è —Ä–µ–ª—å—î—Ñ—É

**–§–∞–π–ª–∏:**
- `main.py`: —Ä—è–¥–∫–∏ 562, 694
- `services/building_processor.py`: —Ä—è–¥–∫–∏ 60, 66, 264, 318, 347
- `services/terrain_generator.py`: —Ä—è–¥–∫–∏ 721-724

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–ò

### –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
- ‚ùå –ü–æ–¥–≤—ñ–π–Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚ùå –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
- ‚ùå –ë—É–¥—ñ–≤–ª—ñ –º–æ–≥–ª–∏ –æ–ø–∏–Ω–∏—Ç–∏—Å—è –ø—ñ–¥ –∑–µ–º–ª–µ—é
- ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π —Å–µ–º–ø–ª—ñ–Ω–≥ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –±—É–¥—ñ–≤–µ–ª—å
- ‚ùå –ê–≥—Ä–µ—Å–∏–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–ª–∞ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ñ–æ—Ä–º
- ‚ùå MultiPolygon –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ –æ–¥–∏–Ω translate_z

### –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
- ‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –º—ñ–∂ –≤—Å—ñ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- ‚úÖ –ë—É–¥—ñ–≤–ª—ñ –∑–∞–≤–∂–¥–∏ –Ω–∞–¥ –∑–µ–º–ª–µ—é –∑ –∑–∞–ø–∞—Å–æ–º
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Å–µ–º–ø–ª—ñ–Ω–≥ –¥–ª—è –±—É–¥—ñ–≤–µ–ª—å –±—É–¥—å-—è–∫–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É
- ‚úÖ –†–æ–∑—É–º–Ω–∞ –∞–≥—Ä–µ—Å–∏–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–ª—è –±—É–¥—å-—è–∫–∏—Ö —Ñ–æ—Ä–º
- ‚úÖ MultiPolygon –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –∑ –æ–∫—Ä–µ–º–∏–º translate_z –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ–ª—ñ–≥–æ–Ω—É

---

## üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å:
- ‚úÖ –í—Å—ñ —Ñ–∞–π–ª–∏ –∫–æ–º–ø—ñ–ª—é—é—Ç—å—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ –õ—ñ–Ω—Ç–µ—Ä –ø–æ–∫–∞–∑—É—î —Ç—ñ–ª—å–∫–∏ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –Ω–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)

### –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:
- ‚úÖ –¢–µ—Å—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ –≤ `tests/test_building_coordinates.py`
- ‚úÖ –í—Å—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ –ø–æ–∫—Ä–∏—Ç—ñ —Ç–µ—Å—Ç–∞–º–∏

---

## üìù –í–ò–ö–û–†–ò–°–¢–ê–ù–ù–Ø

–ö–æ–¥ –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è. –í—Å—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ, –ª–æ–≥—ñ–∫–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–∞, –¥–æ–¥–∞–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.

### –ó–∞–ø—É—Å–∫:
```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python main.py

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
pytest tests/test_building_coordinates.py -v
```

---

## üîç –î–ï–¢–ê–õ–Ü –í–ò–ü–†–ê–í–õ–ï–ù–¨

### –ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏:

1. **main.py:**
   - –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –ø–æ—á–∞—Ç–∫—É (—Ä—è–¥–∫–∏ 556-600)
   - –ü–µ—Ä–µ–¥–∞—á–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ `process_buildings` (—Ä—è–¥–æ–∫ 694)

2. **services/building_processor.py:**
   - –ü–∞—Ä–∞–º–µ—Ç—Ä `coordinates_already_local` –¥–ª—è –ø—Ä–æ–ø—É—Å–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è
   - –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∑ `safety_margin` —Ç–∞ `embed_depth`
   - –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Å–µ–º–ø–ª—ñ–Ω–≥ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –±—É–¥—ñ–≤–µ–ª—å
   - –†–æ–∑—É–º–Ω–∞ –∞–≥—Ä–µ—Å–∏–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ (–Ω–∏–∂–Ω—ñ 20% –≤–∏—Å–æ—Ç–∏)
   - –û–∫—Ä–µ–º–∏–π `translate_z` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ–ª—ñ–≥–æ–Ω—É –≤ MultiPolygon

3. **services/terrain_generator.py:**
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ—Å–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è —Ä–µ–ª—å—î—Ñ—É
   - –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è

---

## ‚ú® –í–ò–°–ù–û–í–û–ö

–í—Å—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ, –∫–æ–¥ –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π —Ç–∞ –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è. –ë—É–¥—ñ–≤–ª—ñ —Ç–µ–ø–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–æ–∑–º—ñ—â—É—é—Ç—å—Å—è –Ω–∞–¥ –∑–µ–º–ª–µ—é –Ω–∞–≤—ñ—Ç—å –Ω–∞ —Å–∫–ª–∞–¥–Ω–æ–º—É —Ä–µ–ª—å—î—Ñ—ñ.

