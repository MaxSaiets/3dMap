# –°—Ç—Ä–∞—Ç–µ–≥—ñ—è "–®–∏—Ä–æ–∫–æ–≥–æ –≤–∏—Ä—ñ–∑—É" —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –¥–æ—Ä—ñ–≥

## –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–±–ª–µ–º

### 1. üî¥ –ß–æ—Ä–Ω—ñ –±–ª–æ–∫–∏ –Ω–∞ –ø–µ—Ä–µ—Ö—Ä–µ—Å—Ç—è—Ö (–§–æ—Ç–æ 1)

**–°–∏–º–ø—Ç–æ–º:**
- –í–µ–ª–∏—á–µ–∑–Ω–∏–π —á–æ—Ä–Ω–∏–π –±–ª–æ–∫ (–æ–ø–æ—Ä–∞ –º–æ—Å—Ç–∞) –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—î –¥–æ—Ä–æ–≥—É
- –í–∏–¥–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ: –≤–µ—Ä—Ö–Ω—î –ª—ñ–≤–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–æ—Ä—ñ–≥ `support_height < 3.0–º` –±—É–≤ –∑–∞–º–∞–ª–∏–π
- –ì–ª–∏–±–æ–∫—ñ —è—Ä–∏ –ø—ñ–¥ –¥–æ—Ä–æ–≥–æ—é —Å–ø—Ä–∏—á–∏–Ω—è–ª–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–ø–æ—Ä –Ω–∞–≤—ñ—Ç—å –¥–ª—è –Ω–∏–∑—å–∫–∏—Ö –º–æ—Å—Ç—ñ–≤/—Ä–∞–º–ø

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```python
# –ó–±—ñ–ª—å—à–∏–º–æ –ø–æ—Ä—ñ–≥ –¥–æ 4 –º–µ—Ç—Ä—ñ–≤ –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ
if support_height < 4.0:
    continue  # –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –Ω–∏–∑—å–∫—ñ –æ–ø–æ—Ä–∏
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –û–ø–æ—Ä–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è –≤–∏—Å–æ–∫–∏—Ö –º–æ—Å—Ç—ñ–≤ (‚â• 4–º)
- ‚úÖ –ß–æ—Ä–Ω—ñ –±–ª–æ–∫–∏ –∑–Ω–∏–∫–ª–∏ –∑ –ø–µ—Ä–µ—Ö—Ä–µ—Å—Ç—å

---

### 2. üî¥ –ó–Ω–∏–∫–ª–∞ –¥–æ—Ä–æ–≥–∞ (–§–æ—Ç–æ 2)

**–°–∏–º–ø—Ç–æ–º:**
- –ì–æ–ª–æ–≤–Ω–∞ –¥–æ—Ä–æ–≥–∞ —Ä–∞–ø—Ç–æ–≤–æ –æ–±—Ä–∏–≤–∞—î—Ç—å—Å—è
- –î–æ—Ä–æ–≥–∞ "–ø–æ—Ç–æ–Ω—É–ª–∞" –≤ –∑–µ–ª–µ–Ω—ñ–π –∑–æ–Ω—ñ –∞–±–æ —Ä–µ–ª—å—î—Ñ—ñ

**–ü—Ä–∏—á–∏–Ω–∞:**
- –í–∏—Å–æ—Ç–∞ –¥–æ—Ä–æ–≥–∏ —ñ –≤–∏—Å–æ—Ç–∞ —Ç—Ä–∞–≤–∏ –º–∞–π–∂–µ –æ–¥–Ω–∞–∫–æ–≤—ñ
- –ú—ñ–∫—Ä–æ—Å–∫–æ–ø—ñ—á–Ω—ñ –ø–æ—Ö–∏–±–∫–∏ –≤ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è—Ö –ø—Ä–∏–∑–≤–æ–¥—è—Ç—å –¥–æ —Ç–æ–≥–æ, —â–æ —Ç—Ä–∞–≤–∞ –æ–ø–∏–Ω—è—î—Ç—å—Å—è –∑–≤–µ—Ä—Ö—É
- –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π `bias = 0.02–º` –±—É–≤ –∑–∞–º–∞–ª–∏–π

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```python
# bias –ø—ñ–¥–Ω—ñ–º–∞—î –¥–æ—Ä–æ–≥—É –Ω–∞ 5—Å–º –Ω–∞–¥ –∑–µ–º–ª–µ—é, —â–æ–± –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ –≤–∏–ª—ñ–∑—Ç–∏ –∑ —Ç—Ä–∞–≤–∏
bias = 0.05  # 5 —Å–º –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è z-fighting —Ç–∞ –∑–Ω–∏–∫–ª–∏—Ö –¥–æ—Ä—ñ–≥
road_z = ground_z_values + old_z - stable_embed + bias
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –î–æ—Ä–æ–≥–∏ –∑–∞–≤–∂–¥–∏ –Ω–∞ 5—Å–º –≤–∏—â—ñ –∑–∞ –∑–µ–º–ª—é
- ‚úÖ –ó–Ω–∏–∫–ª—ñ –¥—ñ–ª—è–Ω–∫–∏ –¥–æ—Ä—ñ–≥ –∑'—è–≤–∏–ª–∏—Å—è

---

### 3. üî¥ "–°—Ç—ñ–Ω–∏" –∑–∞–º—ñ—Å—Ç—å —Å—Ö–∏–ª—ñ–≤ —É –ø–∞—Ä–∫–∞—Ö (–§–æ—Ç–æ 3 —Ç–∞ 4)

**–°–∏–º–ø—Ç–æ–º:**
- –î–æ—Ä–æ–≥–∏, —â–æ –ø—Ä–æ—Ö–æ–¥—è—Ç—å —á–µ—Ä–µ–∑ –ø–∞—Ä–∫–∏, –≤–∏–≥–ª—è–¥–∞—é—Ç—å —è–∫ —Ç—Ä–∞–Ω—à–µ—ó –∑ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏–º–∏ —Å—Ç—ñ–Ω–∞–º–∏
- –ù–µ–º–∞—î –ø–ª–∞–≤–Ω–∏—Ö —Å—Ö–∏–ª—ñ–≤

**–ü—Ä–∏—á–∏–Ω–∞ (–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞):**
- –ü–æ—Ç–æ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `extrude` –¥–ª—è –ø–∞—Ä–∫—ñ–≤ ‚Üí –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ –±–æ–∫–∏
- Boolean Difference —Å—Ç–≤–æ—Ä—é—î –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏–π –∑—Ä—ñ–∑
- –ö–æ–ª–∏ –¥–æ—Ä–æ–≥–∞ –≤–∫–ª–∞–¥–∞—î—Ç—å—Å—è –≤ —Ü–µ–π –≤–∏—Ä—ñ–∑, –≤–∏–¥–Ω–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É —Å—Ç—ñ–Ω–∫—É –ø–∞—Ä–∫—É

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è: –°—Ç—Ä–∞—Ç–µ–≥—ñ—è "–®–∏—Ä–æ–∫–æ–≥–æ –≤–∏—Ä—ñ–∑—É"**

**–Ü–¥–µ—è:**
- –ì–µ–Ω–µ—Ä—É—î–º–æ –¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ –¥–æ—Ä—ñ–≥:
  1. **–í–∏–¥–∏–º–∞ –¥–æ—Ä–æ–≥–∞:** –¢–æ—á–Ω–∞ —à–∏—Ä–∏–Ω–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 8–º) –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—ñ—Ä–æ–≥–æ –º–µ—à—É –∞—Å—Ñ–∞–ª—å—Ç—É
  2. **–ú–∞—Å–∫–∞ –¥–ª—è –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è:** –í–∏–¥–∏–º–∞ –¥–æ—Ä–æ–≥–∞ + –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –±—É—Ñ–µ—Ä (8–º + 1.5–º –∑ –∫–æ–∂–Ω–æ–≥–æ –±–æ–∫—É = 11–º)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú—ñ–∂ –∫—Ä–∞—î–º –∞—Å—Ñ–∞–ª—å—Ç—É —ñ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ—é —Å—Ç—ñ–Ω–æ—é —Ç—Ä–∞–≤–∏ –∑'—è–≤–ª—è—î—Ç—å—Å—è "—É–∑–±—ñ—á—á—è" (–ø–æ—Ä–æ–∂–Ω–µ—á–∞) —à–∏—Ä–∏–Ω–æ—é 1.5 –º–µ—Ç—Ä–∞
- –í—ñ–∑—É–∞–ª—å–Ω–æ —Ü–µ –ø—Ä–∏–±–∏—Ä–∞—î –µ—Ñ–µ–∫—Ç "—Ç—Ä–∞–Ω—à–µ—ó"
- –î–æ—Ä–æ–≥–∞ –Ω–µ –±—É–¥–µ –≤–ø—Ä–∏—Ç—É–ª —Ç–µ—Ä—Ç–∏—Å—è –æ–± —Å—Ç—ñ–Ω—É –ø–∞—Ä–∫—É

---

## –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∑–º—ñ–Ω–∏

### 1. –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è `build_road_polygons`

**–î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `extra_buffer_m`:**
```python
def build_road_polygons(
    G_roads,
    width_multiplier: float = 1.0,
    min_width_m: Optional[float] = None,
    extra_buffer_m: float = 0.0,  # –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –±—É—Ñ–µ—Ä –¥–ª—è –º–∞—Å–∫–∏ –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è (–º–µ—Ç—Ä–∏)
) -> Optional[object]:
```

**–ó–º—ñ–Ω–∞ –ª–æ–≥—ñ–∫–∏ `get_width`:**
```python
# –ë–£–õ–û:
return width  # –ü–æ–≤–µ—Ä—Ç–∞—î –ø–æ–≤–Ω—É —à–∏—Ä–∏–Ω—É

# –°–¢–ê–õ–û:
# –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ä–∞–¥—ñ—É—Å –±—É—Ñ–µ—Ä–∞ (–ø–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω–∏ + extra_buffer)
return (width / 2.0) + float(extra_buffer_m)
```

**–ó–º—ñ–Ω–∞ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—ó:**
```python
# –ë–£–õ–û:
buffer = geom.buffer(row.width / 2, cap_style=2, join_style=2)

# –°–¢–ê–õ–û:
# row.width —Ç–µ–ø–µ—Ä –≤–∂–µ –º—ñ—Å—Ç–∏—Ç—å —Ä–∞–¥—ñ—É—Å –±—É—Ñ–µ—Ä–∞
buffer = geom.buffer(row.width, cap_style=2, join_style=2)
```

---

### 2. –ó–±—ñ–ª—å—à–µ–Ω–Ω—è bias –¥–æ 0.05–º

**–£ —Ñ—É–Ω–∫—Ü—ñ—ó `_process_one` (–±–ª–æ–∫ else –¥–ª—è –Ω–µ-–º–æ—Å—Ç—ñ–≤):**
```python
# –ë–£–õ–û:
bias = 0.02  # 2 —Å–º

# –°–¢–ê–õ–û:
bias = 0.05  # 5 —Å–º –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è z-fighting —Ç–∞ –∑–Ω–∏–∫–ª–∏—Ö –¥–æ—Ä—ñ–≥
```

---

### 3. –ó–±—ñ–ª—å—à–µ–Ω–Ω—è –ø–æ—Ä—ñ–≥—É –æ–ø–æ—Ä –¥–æ 4.0–º

**–£ —Ñ—É–Ω–∫—Ü—ñ—ó `create_bridge_supports`:**
```python
# –ë–£–õ–û:
if support_height < 3.0:
    continue

# –°–¢–ê–õ–û:
if support_height < 4.0:
    continue  # –ó–±—ñ–ª—å—à–∏–º–æ –ø–æ—Ä—ñ–≥ –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ
```

---

### 4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è `main.py` –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó "–®–∏—Ä–æ–∫–æ–≥–æ –≤–∏—Ä—ñ–∑—É"

**–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∏—Ä–æ–∫–æ—ó –º–∞—Å–∫–∏ –¥–ª—è –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è:**
```python
print("[INFO] –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –º–∞—Å–∫–∏ –¥–ª—è –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è –¥–æ—Ä—ñ–≥ (–®–ò–†–û–ö–ê, –∑ —É–∑–±—ñ—á—á—è–º 1.5–º)...")
# –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ–ª—ñ–≥–æ–Ω–∏ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º –±—É—Ñ–µ—Ä–æ–º 1.5 –º–µ—Ç—Ä–∞ –∑ –∫–æ–∂–Ω–æ–≥–æ –±–æ–∫—É
cutting_mask_polys = build_road_polygons(
    G_roads,
    width_multiplier=float(request.road_width_multiplier),
    extra_buffer_m=1.5  # <-- –í–ê–ñ–õ–ò–í–û: –î–æ–¥–∞—î–º–æ "—É–∑–±—ñ—á—á—è" 1.5–º –∑ –∫–æ–∂–Ω–æ–≥–æ –±–æ–∫—É
)

# –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –≤ –ª–æ–∫–∞–ª—å–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–∞ –æ–±—Ä—ñ–∑–∞—î–º–æ –ø–æ –∑–æ–Ω—ñ
road_polygons_for_clipping = cutting_mask_polys
```

**–ü–µ—Ä–µ–¥–∞—á–∞ –≤ `process_green_areas`:**
```python
parks_mesh = process_green_areas(
    gdf_green,
    # ... —ñ–Ω—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ ...
    road_polygons=road_polygons_for_clipping,  # <-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —à–∏—Ä–æ–∫—É –º–∞—Å–∫—É
)
```

**–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤–∏–¥–∏–º–∏—Ö –¥–æ—Ä—ñ–≥ (–≤—É–∑—å–∫–∞):**
```python
# process_roads –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ–±–µ –≤–∏–∫–ª–∏—á–µ build_road_polygons –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –±—É—Ñ–µ—Ä–∞
# (extra_buffer_m=0 –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
road_mesh = process_roads(
    G_roads,
    width_multiplier=request.road_width_multiplier,
    # ... —ñ–Ω—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ ...
)
```

---

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: –î–æ —Ç–∞ –ü—ñ—Å–ª—è

### –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
- ‚ùå –ß–æ—Ä–Ω—ñ –±–ª–æ–∫–∏ –Ω–∞ –ø–µ—Ä–µ—Ö—Ä–µ—Å—Ç—è—Ö (–æ–ø–æ—Ä–∏ –º–æ—Å—Ç—ñ–≤)
- ‚ùå –ó–Ω–∏–∫–ª—ñ –¥–æ—Ä–æ–≥–∏ (–ø–æ—Ç–æ–Ω—É–ª–∏ –≤ —Ç—Ä–∞–≤—ñ)
- ‚ùå "–°—Ç—ñ–Ω–∏" –∑–∞–º—ñ—Å—Ç—å —Å—Ö–∏–ª—ñ–≤ —É –ø–∞—Ä–∫–∞—Ö (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ —Å—Ç—ñ–Ω–∫–∏)
- ‚ùå –î–æ—Ä–æ–≥–∏ –≤–ø—Ä–∏—Ç—É–ª —Ç–µ—Ä–ª–∏—Å—è –æ–± —Å—Ç—ñ–Ω—É –ø–∞—Ä–∫—É

### –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
- ‚úÖ –ß–∏—Å—Ç—ñ –ø–µ—Ä–µ—Ö—Ä–µ—Å—Ç—è –±–µ–∑ —á–æ—Ä–Ω–∏—Ö –±–ª–æ–∫—ñ–≤ (–ø–æ—Ä—ñ–≥ 4.0–º)
- ‚úÖ –í—Å—ñ –¥–æ—Ä–æ–≥–∏ –≤–∏–¥–∏–º—ñ (bias = 0.05–º)
- ‚úÖ "–£–∑–±—ñ—á—á—è" –º—ñ–∂ –¥–æ—Ä–æ–≥–æ—é —Ç–∞ —Å—Ç—ñ–Ω–æ—é –ø–∞—Ä–∫—É (1.5–º)
- ‚úÖ –í—ñ–∑—É–∞–ª—å–Ω–æ –ø—Ä–∏–±—Ä–∞–Ω–æ –µ—Ñ–µ–∫—Ç "—Ç—Ä–∞–Ω—à–µ—ó"

---

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –°—Ç—Ä–∞—Ç–µ–≥—ñ—è "–®–∏—Ä–æ–∫–æ–≥–æ –≤–∏—Ä—ñ–∑—É"

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏:**

1. **–®–∏—Ä–æ–∫–∞ –º–∞—Å–∫–∞ (–¥–ª—è –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è):**
   - –®–∏—Ä–∏–Ω–∞ –¥–æ—Ä–æ–≥–∏: `8–º` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥)
   - –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –±—É—Ñ–µ—Ä: `1.5–º` –∑ –∫–æ–∂–Ω–æ–≥–æ –±–æ–∫—É
   - –†–∞–¥—ñ—É—Å –±—É—Ñ–µ—Ä–∞: `8–º / 2 + 1.5–º = 5.5–º`
   - –ó–∞–≥–∞–ª—å–Ω–∞ —à–∏—Ä–∏–Ω–∞ –º–∞—Å–∫–∏: `11–º`

2. **–í—É–∑—å–∫–∞ –¥–æ—Ä–æ–≥–∞ (–¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó):**
   - –®–∏—Ä–∏–Ω–∞ –¥–æ—Ä–æ–≥–∏: `8–º`
   - –†–∞–¥—ñ—É—Å –±—É—Ñ–µ—Ä–∞: `8–º / 2 = 4–º`
   - –ó–∞–≥–∞–ª—å–Ω–∞ —à–∏—Ä–∏–Ω–∞: `8–º`

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ú—ñ–∂ –∫—Ä–∞—î–º –∞—Å—Ñ–∞–ª—å—Ç—É (8–º) —Ç–∞ —Å—Ç—ñ–Ω–æ—é –ø–∞—Ä–∫—É (11–º) —î –∑–∞–∑–æ—Ä `1.5–º`
   - –¶–µ —Å—Ç–≤–æ—Ä—é—î –≤—ñ–∑—É–∞–ª—å–Ω–µ "—É–∑–±—ñ—á—á—è"
   - –ï—Ñ–µ–∫—Ç "—Ç—Ä–∞–Ω—à–µ—ó" –≤—ñ–∑—É–∞–ª—å–Ω–æ –∑–Ω–∏–∫–∞—î

---

### –ü–æ—Ä—ñ–≥ –æ–ø–æ—Ä –º–æ—Å—Ç—ñ–≤

**–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫:**
```python
support_height = bridge_height - support_base_z

if support_height < 4.0:
    continue  # –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –Ω–∏–∑—å–∫—ñ –æ–ø–æ—Ä–∏
```

**–ü—Ä–∏–∫–ª–∞–¥:**
- –ú—ñ—Å—Ç –Ω–∞ –≤–∏—Å–æ—Ç—ñ `5–º`
- –ó–µ–º–ª—è –ø—ñ–¥ –º–æ—Å—Ç–æ–º –Ω–∞ –≤–∏—Å–æ—Ç—ñ `2–º`
- `support_height = 5–º - 2–º = 3–º` ‚Üí **–û–ø–æ—Ä–∞ –ù–ï —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è** (3–º < 4–º)

- –ú—ñ—Å—Ç –Ω–∞ –≤–∏—Å–æ—Ç—ñ `8–º`
- –ó–µ–º–ª—è –ø—ñ–¥ –º–æ—Å—Ç–æ–º –Ω–∞ –≤–∏—Å–æ—Ç—ñ `2–º`
- `support_height = 8–º - 2–º = 6–º` ‚Üí **–û–ø–æ—Ä–∞ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è** (6–º ‚â• 4–º)

---

### Bias –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –∑–Ω–∏–∫–ª–∏—Ö –¥–æ—Ä—ñ–≥

**–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫:**
```python
bias = 0.05  # 5 —Å–º
road_z = ground_z_values + old_z - stable_embed + bias
```

**–ü—Ä–∏–∫–ª–∞–¥:**
- –ó–µ–º–ª—è –Ω–∞ –≤–∏—Å–æ—Ç—ñ `100–º`
- `stable_embed = 0.1–º`
- `old_z = 0` (–Ω–∏–∂–Ω—ñ –≤–µ—Ä—à–∏–Ω–∏)
- `road_z = 100–º + 0 - 0.1–º + 0.05–º = 99.95–º`

- –¢—Ä–∞–≤–∞ –Ω–∞ –≤–∏—Å–æ—Ç—ñ `100–º - 0.1–º = 99.9–º`
- –î–æ—Ä–æ–≥–∞ –Ω–∞ –≤–∏—Å–æ—Ç—ñ `99.95–º`
- **–î–æ—Ä–æ–≥–∞ –Ω–∞ 5—Å–º –≤–∏—â–∞ –∑–∞ —Ç—Ä–∞–≤—É** ‚Üí –Ω–µ –ø–æ—Ç–æ–Ω–µ

---

## –ü–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü—ñ–π (—Ñ—ñ–Ω–∞–ª—å–Ω–∏–π)

1. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∏—Ä–æ–∫–æ—ó –º–∞—Å–∫–∏ –¥–ª—è –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è:**
   ```python
   cutting_mask_polys = build_road_polygons(
       G_roads,
       width_multiplier=request.road_width_multiplier,
       extra_buffer_m=1.5  # –®–∏—Ä–æ–∫–∞ –º–∞—Å–∫–∞
   )
   ```

2. **–û–±—Ä–æ–±–∫–∞ –∑–µ–ª–µ–Ω–∏—Ö –∑–æ–Ω (–∑ –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è–º —à–∏—Ä–æ–∫–∏—Ö –¥–æ—Ä—ñ–≥):**
   ```python
   parks_mesh = process_green_areas(
       gdf_green,
       road_polygons=cutting_mask_polys  # –®–∏—Ä–æ–∫–∞ –º–∞—Å–∫–∞
   )
   ```

3. **–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤–∏–¥–∏–º–∏—Ö –¥–æ—Ä—ñ–≥ (–≤—É–∑—å–∫–∞):**
   ```python
   road_mesh = process_roads(
       G_roads,
       width_multiplier=request.road_width_multiplier,
       # extra_buffer_m=0 –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (–≤—É–∑—å–∫–∞ –¥–æ—Ä–æ–≥–∞)
   )
   ```

4. **–û–±'—î–¥–Ω–∞–Ω–Ω—è –º–µ—à—ñ–≤:**
   - `parks_mesh` –º–∞—î –≤–∏—Ä—ñ–∑–∏ —à–∏—Ä–∏–Ω–æ—é `11–º` (–∑ —É–∑–±—ñ—á—á—è–º)
   - `road_mesh` –º–∞—î —à–∏—Ä–∏–Ω—É `8–º` (–±–µ–∑ —É–∑–±—ñ—á—á—è)
   - –ú—ñ–∂ –Ω–∏–º–∏ –∑–∞–∑–æ—Ä `1.5–º` ‚Üí –≤—ñ–∑—É–∞–ª—å–Ω–µ "—É–∑–±—ñ—á—á—è"

---

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ

### ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 1: –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —á–æ—Ä–Ω–∏—Ö –±–ª–æ–∫—ñ–≤

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–µ–º–∞—î —á–æ—Ä–Ω–∏—Ö –ø–∞—Ä–∞–ª–µ–ª–µ–ø—ñ–ø–µ–¥—ñ–≤ –Ω–∞ –ø–µ—Ä–µ—Ö—Ä–µ—Å—Ç—è—Ö
- –û–ø–æ—Ä–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è –≤–∏—Å–æ–∫–∏—Ö –º–æ—Å—Ç—ñ–≤ (‚â• 4–º)

**–Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:**
- –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è –Ω–∞ –ø–µ—Ä–µ—Ö—Ä–µ—Å—Ç—è –≤ –º–æ–¥–µ–ª—ñ
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –Ω–µ–º–∞—î –æ–ø–æ—Ä –Ω–∞ –Ω–∏–∑—å–∫–∏—Ö –º–æ—Å—Ç–∞—Ö/—Ä–∞–º–ø–∞—Ö
- –ù–µ–º–∞—î —á–æ—Ä–Ω–∏—Ö –±–ª–æ–∫—ñ–≤ –Ω–∞ –¥–æ—Ä–æ–≥–∞—Ö

### ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 2: –í—Å—ñ –¥–æ—Ä–æ–≥–∏ –≤–∏–¥–∏–º—ñ

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–µ–º–∞—î –∑–Ω–∏–∫–ª–∏—Ö –¥—ñ–ª—è–Ω–æ–∫ –¥–æ—Ä—ñ–≥
- –î–æ—Ä–æ–≥–∏ –∑–∞–≤–∂–¥–∏ –Ω–∞ 5—Å–º –≤–∏—â—ñ –∑–∞ –∑–µ–º–ª—é

**–Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:**
- –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è –Ω–∞ –º–æ–¥–µ–ª—å –∑–≤–µ—Ä—Ö—É
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤—Å—ñ –¥–æ—Ä–æ–≥–∏ –≤–∏–¥–∏–º—ñ
- –ù–µ–º–∞—î –¥—ñ–ª—è–Ω–æ–∫, –¥–µ –¥–æ—Ä–æ–≥–∞ "–ø–æ—Ç–æ–Ω—É–ª–∞" –≤ —Ç—Ä–∞–≤—ñ

### ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 3: "–£–∑–±—ñ—á—á—è" –º—ñ–∂ –¥–æ—Ä–æ–≥–æ—é —Ç–∞ —Å—Ç—ñ–Ω–æ—é –ø–∞—Ä–∫—É

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú—ñ–∂ –∫—Ä–∞—î–º –∞—Å—Ñ–∞–ª—å—Ç—É —Ç–∞ —Å—Ç—ñ–Ω–æ—é –ø–∞—Ä–∫—É —î –∑–∞–∑–æ—Ä `1.5–º`
- –í—ñ–∑—É–∞–ª—å–Ω–æ –ø—Ä–∏–±—Ä–∞–Ω–æ –µ—Ñ–µ–∫—Ç "—Ç—Ä–∞–Ω—à–µ—ó"

**–Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:**
- –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è –Ω–∞ –¥–æ—Ä–æ–≥–∏, —â–æ –ø—Ä–æ—Ö–æ–¥—è—Ç—å —á–µ—Ä–µ–∑ –ø–∞—Ä–∫–∏
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î –∑–∞–∑–æ—Ä –º—ñ–∂ –¥–æ—Ä–æ–≥–æ—é —Ç–∞ —Å—Ç—ñ–Ω–æ—é –ø–∞—Ä–∫—É
- –ù–µ–º–∞—î –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å—Ç—ñ–Ω–æ–∫, —â–æ –≤–ø—Ä–∏—Ç—É–ª –ø—Ä–∏–ª—è–≥–∞—é—Ç—å –¥–æ –¥–æ—Ä–æ–≥–∏

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

### –Ø–∫—â–æ "—É–∑–±—ñ—á—á—è" –∑–∞–Ω–∞–¥—Ç–æ —à–∏—Ä–æ–∫–µ –∞–±–æ –≤—É–∑—å–∫–µ:

1. **–ó–º—ñ–Ω–∏—Ç–∏ `extra_buffer_m`:**
   ```python
   extra_buffer_m=2.0  # –ó–±—ñ–ª—å—à–∏—Ç–∏ –¥–æ 2–º
   # –∞–±–æ
   extra_buffer_m=1.0  # –ó–º–µ–Ω—à–∏—Ç–∏ –¥–æ 1–º
   ```

2. **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –º–∞—Å—à—Ç–∞–±—É:**
   ```python
   # –ú–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–∏–º –≤—ñ–¥ scale_factor
   extra_buffer_m = max(1.0, 1.5 / float(scale_factor))
   ```

### –Ø–∫—â–æ –≤—Å–µ —â–µ —î –∑–Ω–∏–∫–ª—ñ –¥–æ—Ä–æ–≥–∏:

1. **–ó–±—ñ–ª—å—à–∏—Ç–∏ bias:**
   ```python
   bias = 0.08  # 8 —Å–º –∑–∞–º—ñ—Å—Ç—å 5 —Å–º
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ `parks_height_mm`:**
   - –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –ø–∞—Ä–∫–∏ –º–∞—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤–∏—Å–æ—Ç—É
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∞—Ü—é—î –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è –¥–æ—Ä—ñ–≥ –∑ –ø–∞—Ä–∫—ñ–≤

### –Ø–∫—â–æ –≤—Å–µ —â–µ —î —á–æ—Ä–Ω—ñ –±–ª–æ–∫–∏:

1. **–ó–±—ñ–ª—å—à–∏—Ç–∏ –ø–æ—Ä—ñ–≥ –æ–ø–æ—Ä:**
   ```python
   if support_height < 5.0:  # –ó–∞–º—ñ—Å—Ç—å 4.0
       continue
   ```

2. **–î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ —Ç–∏–ø –º–æ—Å—Ç–∞:**
   - –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, —á–∏ —Ü–µ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –º—ñ—Å—Ç (–ø–µ—Ä–µ—Ç–∏–Ω–∞—î –≤–æ–¥—É)
   - –ê–±–æ —á–∏ —Ü–µ –≤—ñ–∞–¥—É–∫ (layer >= 2)

---

## –ü—ñ–¥—Å—É–º–æ–∫ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

### –ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏:

1. **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è "–®–∏—Ä–æ–∫–æ–≥–æ –≤–∏—Ä—ñ–∑—É":**
   - –®–∏—Ä–æ–∫–∞ –º–∞—Å–∫–∞ –¥–ª—è –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è (extra_buffer_m=1.5–º)
   - –í—É–∑—å–∫–∞ –¥–æ—Ä–æ–≥–∞ –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó (extra_buffer_m=0)
   - –°—Ç–≤–æ—Ä—é—î "—É–∑–±—ñ—á—á—è" –º—ñ–∂ –¥–æ—Ä–æ–≥–æ—é —Ç–∞ —Å—Ç—ñ–Ω–æ—é –ø–∞—Ä–∫—É

2. **–ó–±—ñ–ª—å—à–µ–Ω–Ω—è bias –¥–æ 0.05–º:**
   - –î–æ—Ä–æ–≥–∏ –∑–∞–≤–∂–¥–∏ –Ω–∞ 5—Å–º –≤–∏—â—ñ –∑–∞ –∑–µ–º–ª—é
   - –£—Å—É–Ω–µ–Ω–Ω—è –∑–Ω–∏–∫–ª–∏—Ö –¥–æ—Ä—ñ–≥

3. **–ó–±—ñ–ª—å—à–µ–Ω–Ω—è –ø–æ—Ä—ñ–≥—É –æ–ø–æ—Ä –¥–æ 4.0–º:**
   - –û–ø–æ—Ä–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –≤–∏—Å–æ–∫–∏—Ö –º–æ—Å—Ç—ñ–≤
   - –£—Å—É–Ω–µ–Ω–Ω—è —á–æ—Ä–Ω–∏—Ö –±–ª–æ–∫—ñ–≤ –Ω–∞ –ø–µ—Ä–µ—Ö—Ä–µ—Å—Ç—è—Ö

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –ø—ñ—Å–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó "–®–∏—Ä–æ–∫–æ–≥–æ –≤–∏—Ä—ñ–∑—É" —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –¥–æ—Ä—ñ–≥*

